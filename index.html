<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Knowledge Base Playground</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#fff0f6;--bg2:#e6f7ff;--ink:#1e1e2a;--muted:#5e5e76;--card:#ffffffcc;
  --accent:#6a5cff;--accent-2:#ff6ec7;--accent-3:#00c2ff;--shadow:0 10px 30px rgba(0,0,0,.08);
  --radius:18px;--tile:72px;--gap:12px;--board-pad-x:12px;--game-pad-x:16px
}
*{box-sizing:border-box}html,body{height:100%}
body{
  margin:0;font-family:"Fredoka",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  color:var(--ink);
  background:
   radial-gradient(1200px 800px at 10% -10%,var(--bg2),transparent 60%),
   radial-gradient(1200px 800px at 110% 10%,var(--bg1),transparent 60%),
   linear-gradient(180deg,#fafcff,#fff);
  display:grid;place-items:start center;padding:32px 18px 56px;overflow-x:hidden
}
/* halo blobs */
.halo{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:-1}
.halo .blob{position:absolute;width:38vmax;height:38vmax;filter:blur(50px);opacity:.45;border-radius:50%;animation:float 18s ease-in-out infinite;mix-blend-mode:multiply}
.blob.b1{background:#ffd2f1;left:-10vmax;top:-8vmax}
.blob.b2{background:#d6eaff;right:-12vmax;top:10vmax;animation-delay:3s}
.blob.b3{background:#e2ffef;left:15vmax;bottom:-12vmax;animation-delay:6s}
@keyframes float{0%,100%{transform:translate3d(0,0,0)}50%{transform:translate3d(0,-20px,0)}}

main{width:min(1080px,100%);text-align:center;display:flex;flex-direction:column;min-height:100%}
.badge{display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .8rem;border-radius:999px;background:#ffffffc7;box-shadow:var(--shadow);font-size:.9rem;letter-spacing:.25px;align-self:center}
.title{margin:16px 0 6px;font-size:clamp(2rem,4.5vw,3.25rem);line-height:1.05}
.subtitle{margin:0 auto 28px;color:var(--muted);max-width:55ch;font-size:clamp(1rem,2.2vw,1.15rem)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;margin-top:24px}

/* ===== Cards that open in viewer ===== */
.card{
  position:relative;background:var(--card);backdrop-filter:blur(8px);border-radius:var(--radius);
  padding:22px 20px;text-align:left;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.04);
  transform:perspective(700px) rotateX(0) rotateY(0);
  transition:transform .15s ease, box-shadow .25s ease, background .25s ease;
  will-change:transform; overflow:hidden; cursor:pointer; color:inherit;
}
button.card{ font:inherit; color:inherit; }
.card::before{content:"";position:absolute;inset:-2px;border-radius:inherit;pointer-events:none;opacity:0;
  background:conic-gradient(from 180deg,var(--accent),var(--accent-2),var(--accent-3),var(--accent));
  filter:blur(12px);transition:opacity .25s ease}
.card::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,transparent 35%, rgba(106,92,255,.18) 45%, rgba(255,110,199,.18) 50%, rgba(0,194,255,.18) 55%, transparent 65%);
  transform:translateX(-120%);transition:transform .6s ease}
.card:hover::after{transform:translateX(120%)} .card:hover::before{opacity:.45}
.card:hover{box-shadow:0 18px 40px rgba(0,0,0,.12)}
.card .emoji{font-size:2rem;margin-bottom:8px;display:inline-block;transform-origin:bottom}
.card:hover .emoji{animation:bob .8s ease-in-out infinite}@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
.card h3{margin:4px 0 8px;font-size:1.25rem}
.card p{margin:0;color:var(--muted);font-size:.98rem}
.chip{display:inline-flex;align-items:center;gap:.35rem;font-size:.78rem;padding:.25rem .55rem;border-radius:999px;background:#f2efff;color:#4e43ff;font-weight:600;margin-left:6px}
.soon{cursor:not-allowed;opacity:.8}.soon .chip{background:#ffe9f6;color:#ff2a9e}
.card h3,.card p,.card .chip{transition:color .18s ease, background-color .18s ease, box-shadow .18s ease}
.card:hover h3{color:#0f1020}.card:hover p{color:#2f2f48}
.card:hover .chip{background:#e9e6ff;color:#3a2fff;box-shadow:0 0 0 2px rgba(106,92,255,.12) inset}

/* ripple click */
.ripple{position:absolute;width:12px;height:12px;border-radius:999px;background:radial-gradient(circle,rgba(255,255,255,.8) 0%,rgba(255,255,255,0) 70%);pointer-events:none;transform:translate(-50%,-50%) scale(1);opacity:.9}
@keyframes ripple{to{opacity:0;transform:translate(-50%,-50%) scale(12)}}

footer{margin-top:30px;color:var(--muted);font-size:.9rem}
.spacer{flex:1 1 auto}

/* ===== Arcade ===== */
.arcade{position:relative;width:min(980px,100%);margin:28px auto 0;background:#ffffffba;border:1px solid rgba(0,0,0,.04);border-radius:var(--radius);box-shadow:var(--shadow);overflow:visible} /* <- allow shadows to show */
.arcade .bar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(180deg,#fff,#fafaff)}
.tablist{display:flex;gap:8px;flex-wrap:wrap}
.tab{appearance:none;border:1px solid #ecebff;background:#f7f7ff;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer;color:#4a43ff}
.tab[aria-selected="true"]{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;border-color:transparent;box-shadow:0 8px 18px rgba(106,92,255,.2)}
.arcade .mute{margin-left:auto;background:#f0f0ff;color:#4a43ff;border:1px solid #ecebff;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
.arcade .mute.active{background:#ffe6f6;color:#d91b8d;border-color:transparent}
.panel{position:relative;display:none;padding:16px var(--game-pad-x) 22px}
.panel[aria-hidden="false"]{display:block}

/* ===== Whack-a-Hub ===== */
.game{position:relative;margin:0 auto;text-align:center}
.game .hud{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:10px;color:var(--muted);font-weight:600}
.game .hud .pill{background:#f6f5ff;padding:.45rem .7rem;border-radius:999px}
.game .hud button{appearance:none;border:0;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:800;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 10px 20px rgba(106,92,255,.25)}
.board{--tile:72px;width:min(calc((var(--tile)*9)+(var(--gap)*8)+((var(--board-pad-x)+var(--game-pad-x))*2)),100%);display:flex;gap:var(--gap);justify-content:center;overflow-x:auto;padding:6px var(--board-pad-x);-webkit-overflow-scrolling:touch;scrollbar-width:none}
.board::-webkit-scrollbar{display:none}
.hole{position:relative;width:var(--tile);height:var(--tile);background:#fafaff;border:1px dashed #e6e4ff;border-radius:16px;display:grid;place-items:center;flex:0 0 var(--tile);overflow:hidden}
.spot{display:inline-flex;align-items:center;justify-content:center;width:52px;height:52px;border-radius:50%;background:#fff;border:1px solid #eee;box-shadow:var(--shadow);font-size:28px;line-height:1;transform:translateY(110%)}
.spot.live{transform:translateY(0)}
.overlay{position:absolute;inset:0;display:none;place-items:center;background:rgba(255,255,255,.32);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:5}
.overlay.visible{display:grid}
.count{font-size:clamp(3rem,12vw,6rem);font-weight:900;line-height:1;margin:0;letter-spacing:.02em;color:#1e1e2a}
.legend{margin-top:10px;font-size:clamp(0.86rem,1.6vw,0.95rem);color:#7b7b97;line-height:1.35}

/* ===== Click When Green ===== */
.green-game{position:relative;margin:0 auto;text-align:center}
.green-wrap{display:grid;place-items:center;padding:12px}
.green{position:relative;width:140px;height:140px;border-radius:50%;border:0;cursor:not-allowed;box-shadow:var(--shadow);transition:transform .15s ease, filter .15s ease, background-color .15s ease}
.green::before{content:"";position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 50% 40%, rgba(255,255,255,.85), rgba(255,255,255,0) 48%), radial-gradient(circle at 50% 60%, rgba(0,0,0,.08), transparent 60%)}
.green.state-idle{background:#e9e9ef}
.green.state-armed{background:#ffb3b3;filter:saturate(110%)}
.green.state-wait{background:#ffe8a3}
.green.state-go{background:#b7f5d1;filter:saturate(120%);animation:pulse 0.9s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
  
/* ===== Inline Viewer (FULL PAGE) ===== */
.viewer{position:fixed;inset:0;display:none;place-items:stretch;background:#fff;z-index:50}
.viewer.visible{display:grid}
.viewer-box{width:100vw;height:100vh;background:#fff;display:flex;flex-direction:column;overflow:hidden}
.viewer-bar{position:sticky;top:0;z-index:2;display:flex;align-items:center;gap:10px;padding:10px 12px;background:linear-gradient(180deg,#fff,#fafaff);border-bottom:1px solid #f0f0f8}
.viewer-title{font-weight:800}
.viewer-actions{margin-left:auto;display:flex;gap:8px}
.viewer-actions button{appearance:none;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
.viewer-close{background:#ffe6f6;color:#d91b8d}
.viewer-open{background:#f0f0ff;color:#4a43ff}
.viewer-iframe{flex:1;border:0;width:100%}
body.viewer-open{overflow:hidden}

/* ===== Trivia Sprint â€¢ Daily Modal ===== */
.tv-modal{position:fixed;inset:0;display:none;place-items:center;z-index:60;background:rgba(255,255,255,.36);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}
.tv-modal.show{display:grid}
.tv-card{width:min(720px,92vw);background:#fff;border:1px solid #eee;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.12);padding:18px}
.tv-head{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:6px}
.tv-title{font-weight:900;font-size:1.2rem}
.tv-controls{display:flex;gap:8px}
.tv-btn{appearance:none;border:0;border-radius:10px;padding:10px 12px;font-weight:800;cursor:pointer;color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 10px 20px rgba(106,92,255,.25)}
.tv-ghost{background:#f7f7ff;color:#4a43ff;border:1px solid #ecebff}
.tv-body{margin-top:6px}
.tv-hud{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:8px 0}
.tv-pill{background:#f6f5ff;padding:.45rem .7rem;border-radius:999px;font-weight:700;color:#5e5e76}
.tv-q{margin:10px 0 8px;font-weight:800}
.tv-choices{display:grid;gap:8px}
.tv-choice{appearance:none;border:1px solid #ecebff;background:#f7f7ff;border-radius:10px;padding:10px 12px;text-align:left;cursor:pointer;font-weight:700;color:#4a43ff}
.tv-choice.correct{background:#e6fff0;border-color:#b7f5d1;color:#106b3b}
.tv-choice.wrong{background:#fff3f3;border-color:#ffd3d3;color:#a12c2c}
.tv-foot{margin-top:10px;text-align:center;color:#7b7b97}

@media (max-width:380px){.board{--tile:64px}}

/* sparkle layer (fixed overlay above content, below modals) */
.sparkle-layer{position:fixed;inset:0;pointer-events:none;z-index:30}
.sparkle-layer .sparkle{position:absolute;display:block;will-change:transform,opacity}

</style>
</head><body>
<div class="sparkle-layer" aria-hidden="true"></div>
<div class="halo" aria-hidden="true"><div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div></div>

<main>
  <div class="badge">ğŸ‰ <span id="avatarBadge">welcome aboard</span> <span class="chip">KP360</span></div>
  <h1 class="title">Your Knowledge Base Playground</h1>
  <p class="subtitle">Quick links to the hubs you use every day. Click a card to jump in!</p>

  <section class="grid" aria-label="Knowledge base links">
    <button class="card tilt" type="button" data-url="https://kp360-po.github.io/Hub/#home" data-title="PO Hub">
      <div class="emoji">ğŸ“¦</div><h3>PO Hub <span class="chip">live</span></h3>
      <p>Purchase Order resources, playbooks, and helpful tooling.</p>
    </button>
    <button class="card tilt" type="button" data-url="https://kp360-po.github.io/WooHub/" data-title="WooHub">
      <div class="emoji">ğŸ›’</div><h3>WooHub <span class="chip">live</span></h3>
      <p>WooParts and AutoApex workflows, guides, and integrations.</p>
    </button>
    <button class="card tilt soon" type="button" disabled title="Coming soon!">
      <div class="emoji">ğŸ’¸</div><h3>Costing Hub <span class="chip">coming soon</span></h3>
      <p>Cost models, margin calculators, and pricing rules.</p>
    </button>
  </section>

  <div class="spacer" aria-hidden="true"></div>

  <!-- ===== Arcade Tabs ===== -->
  <section class="arcade" aria-label="Arcade">
    <div class="bar">
      <div class="tablist" role="tablist" aria-label="Game tabs">
        <button class="tab" role="tab" aria-selected="true"  aria-controls="panel-whack"   id="tab-whack">ğŸ”¨ Whack-a-Hub</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="panel-green"   id="tab-green">ğŸŸ¢ Click When Green</button>
      </div>
    </div>

    <!-- Whack-a-Hub -->
    <div class="panel" id="panel-whack" role="tabpanel" aria-labelledby="tab-whack" aria-hidden="false">
      <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-live="assertive"><div id="count" class="count">3</div></div>
      <h3 class="game-tag">â˜• Take a quick break â€” whack a hub for 30 seconds!</h3>
      <div class="game" aria-label="Whack-a-Hub game"
           style="cursor:url('data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;32&quot; height=&quot;32&quot; viewBox=&quot;0 0 32 32&quot;><g fill=&quot;%23333&quot;><path d=&quot;M20.8 3.6c-.7-.6-1.8-.6-2.4.1l-3 3 2.9 2.9 3-3c.7-.7.7-1.7-.1-2.4l-.4-.4z&quot;/><path d=&quot;M6.1 20.2l7.7-7.7 3.2 3.2-7.7 7.7c-.5.5-1.2.8-1.9.8l-3.1.3.3-3.1c.1-.8.4-1.5.9-2.1z&quot;/></g></svg>') 6 6,pointer">
        <div class="hud" role="status" aria-live="polite">
          <span class="pill">â±ï¸ Time: <strong id="time">30</strong>s</span>
          <span class="pill">ğŸ¯ Score: <strong id="score">0</strong></span>
          <span class="pill">ğŸ† Best: <strong id="best">0</strong></span>
          <button id="startBtn" type="button">Start Game</button>
        </div>
        <div class="board" id="board">
          <button class="hole" aria-label="Hole 1"><span class="spot" aria-hidden="true">ğŸ‰</span></button>
          <button class="hole" aria-label="Hole 2"><span class="spot" aria-hidden="true">âœ¨</span></button>
          <button class="hole" aria-label="Hole 3"><span class="spot" aria-hidden="true">ğŸˆ</span></button>
          <button class="hole" aria-label="Hole 4"><span class="spot" aria-hidden="true">ğŸ’«</span></button>
          <button class="hole" aria-label="Hole 5"><span class="spot" aria-hidden="true">ğŸŒŸ</span></button>
          <button class="hole" aria-label="Hole 6"><span class="spot" aria-hidden="true">ğŸª„</span></button>
          <button class="hole" aria-label="Hole 7"><span class="spot" aria-hidden="true">ğŸŠ</span></button>
          <button class="hole" aria-label="Hole 8"><span class="spot" aria-hidden="true">ğŸ€</span></button>
          <button class="hole" aria-label="Hole 9"><span class="spot" aria-hidden="true">ğŸ””</span></button>
        </div>
        <p class="legend">Hit the popping emoji! Use mouse/tap or press <kbd>1â€“9</kbd>. Press <kbd>Space</kbd>/<kbd>S</kbd> to start.</p>
      </div>
    </div>

<!-- Click When Green -->
<div class="panel" id="panel-green" role="tabpanel" aria-labelledby="tab-green" aria-hidden="true">
  <h3 class="game-tag">âš¡ Test your reflex â€” click as soon as it turns green!</h3>
  <div class="game green-game" aria-label="Click When Green game">
    <div class="hud" role="status" aria-live="polite">
      <span class="pill">â±ï¸ Last: <strong id="gLast">â€“</strong> ms</span>
      <span class="pill">ğŸ† Best: <strong id="gBest">â€“</strong> ms</span>
      <span class="pill">ğŸ“Š Avg (5): <strong id="gAvg">â€“</strong> ms</span>
      <button id="gStart" type="button">Start</button>
    </div>
    <div class="green-wrap">
      <button id="gLight" class="green state-idle" type="button" aria-label="reaction target" disabled></button>
      <div id="gStatus" class="legend" aria-live="polite">Press Start, then click when it turns green.</div>
    </div>
    <p class="legend">Tip: You can also press <kbd>Space</kbd>/<kbd>Enter</kbd> to click.</p>
  </div>
</div>

<!-- ===== Inline Viewer Overlay ===== -->
<div class="viewer" id="viewer" aria-hidden="true" aria-label="Hub viewer">
  <div class="viewer-box" role="dialog" aria-modal="true">
    <div class="viewer-bar">
      <button class="viewer-close" id="viewerBack" type="button">â† Back</button>
      <div class="viewer-title" id="viewerTitle">Hub</div>
      <div class="viewer-actions"><button class="viewer-open" id="viewerOpen" type="button">Open in new tab</button></div>
    </div>
    <iframe class="viewer-iframe" id="viewerFrame" title="Hub content" sandbox="allow-scripts allow-same-origin allow-forms allow-modals allow-popups"></iframe>
  </div>
</div>

<!-- ===== Trivia Sprint â€¢ Daily Modal (outside Arcade) ===== -->
<div id="tvModal" class="tv-modal" aria-hidden="true" aria-label="Trivia Sprint modal">
  <div class="tv-card" role="dialog" aria-modal="true">
    <div class="tv-head">
      <div class="tv-title">ğŸ§© Trivia Sprint â€” quick 5 from PO Hub</div>
      <div class="tv-controls">
        <button id="tvSkip"  class="tv-btn tv-ghost" type="button" title="Close for now">Skip</button>
        <button id="tvStart" class="tv-btn" type="button">Start</button>
      </div>
    </div>
    <div class="tv-body">
      <div class="tv-hud">
        <span class="tv-pill">â±ï¸ <b id="tvTime">60</b>s</span>
        <span class="tv-pill">âœ… <b id="tvScore">0</b>/5</span>
        <span class="tv-pill">ğŸ† Best: <b id="tvBest">0</b></span>
      </div>
      <div id="tvBox" hidden>
        <p class="tv-q" id="tvQ">Questionâ€¦</p>
        <div class="tv-choices" id="tvChoices"></div>
      </div>
      <p id="tvStatus" class="tv-foot">Loading questions from PO Hubâ€¦</p>
    </div>
  </div>
</div>

<script>
/* confetti on load */
(function(){const r=matchMedia('(prefers-reduced-motion: reduce)').matches;if(r)return;
const E=["ğŸ‰","âœ¨","ğŸˆ","ğŸ’«","ğŸŒŸ"];for(let i=0;i<12;i++){const s=document.createElement('div');
s.textContent=E[Math.floor(Math.random()*E.length)];
Object.assign(s.style,{position:'fixed',left:(Math.random()*100)+'vw',top:'-10vh',fontSize:(18+Math.random()*20)+'px',transform:`rotate(${Math.random()*360}deg)`,opacity:.9,pointerEvents:'none',zIndex:2});
document.body.appendChild(s);const d=2600+Math.random()*1600,x=(Math.random()*40-20)+'vw';
s.animate?.([{transform:s.style.transform,offset:0,top:'-10vh'},{transform:`rotate(${Math.random()*360}deg)`,offset:.7,left:`calc(${s.style.left} + ${x})`},{transform:`rotate(${Math.random()*360}deg)`,offset:1,top:'110vh'}],{duration:d,easing:'ease-in',fill:'forwards'})?.addEventListener('finish',()=>s.remove());
setTimeout(()=>s.remove(),d+250)}})();

/* Card tilt + ripple + open viewer */
(function(){
  const cards=[...document.querySelectorAll('.card.tilt')];
  const reduced=matchMedia('(prefers-reduced-motion: reduce)').matches;
  const viewer=document.getElementById('viewer'), frame=document.getElementById('viewerFrame');
  const vTitle=document.getElementById('viewerTitle'), vOpen=document.getElementById('viewerOpen'), vBack=document.getElementById('viewerBack');
  function openViewer(url,title){vTitle.textContent=title||'Hub';vOpen.onclick=()=>window.open(url,'_blank','noopener');frame.src=url;viewer.classList.add('visible');viewer.setAttribute('aria-hidden','false');document.body.classList.add('viewer-open')}
  function closeViewer(){viewer.classList.remove('visible');viewer.setAttribute('aria-hidden','true');frame.removeAttribute('src');document.body.classList.remove('viewer-open')}
  vBack.addEventListener('click',closeViewer); viewer.addEventListener('click',(e)=>{ if(e.target===viewer) closeViewer(); });
  addEventListener('keydown',(e)=>{ if(e.key==='Escape'&&viewer.classList.contains('visible')) closeViewer(); });

  cards.forEach(card=>{
    card.addEventListener('pointermove',e=>{ if(reduced) return; const r=card.getBoundingClientRect(),x=(e.clientX-r.left)/r.width,y=(e.clientY-r.top)/r.height; card.style.transform=`perspective(700px) rotateX(${(y-.5)*8}deg) rotateY(${(x-.5)*-10}deg)`; });
    card.addEventListener('pointerleave',()=>{card.style.transform='perspective(700px) rotateX(0) rotateY(0)'});
    card.addEventListener('click',(e)=>{const r=card.getBoundingClientRect(),dot=document.createElement('span');dot.className='ripple';dot.style.left=(e.clientX-r.left)+'px';dot.style.top=(e.clientY-r.top)+'px';card.appendChild(dot);dot.style.animation='ripple .7s ease-out forwards';setTimeout(()=>dot.remove(),750); const url=card.dataset.url; if(url){ openViewer(url,card.dataset.title||card.querySelector('h3')?.textContent?.trim()); }},{passive:true});
  });
})();

/* GLOBAL sparkle trail */
(function(){
  const layer=document.querySelector('.sparkle-layer'); if(!layer) return;
  if(matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  const palettes={ sparkles:['#6a5cff','#ff6ec7','#00c2ff','#ffd166','#7effb2'], stars:['#ffd166','#fff','#ffe9a8'], hearts:['#ff6ec7','#ff9ac8','#ff2a9e'], ribbons:['#a78bfa','#60a5fa','#34d399'] };
  let last=0;
  function currentStyle(){return localStorage.getItem('kp360_trail')||'sparkles'}
  function spawn(x,y){
    const st=currentStyle(), colors=palettes[st]||palettes.sparkles;
    const s=document.createElement('span');s.className='sparkle';
    const size=6+Math.random()*10; Object.assign(s.style,{left:x+'px',top:y+'px',width:size+'px',height:size+'px',borderRadius:'50%',background:colors[Math.floor(Math.random()*colors.length)],filter:'blur(1px)',boxShadow:'0 0 12px rgba(255,255,255,.6)'}); layer.appendChild(s);
    s.animate?.([{opacity:.95,transform:'translateY(0) scale(1)'},{opacity:0,transform:`translateY(-10px) scale(${1+Math.random()*0.6})`}],{duration:600,easing:'ease-out',fill:'forwards'})?.addEventListener('finish',()=>s.remove());
    setTimeout(()=>s.remove(),650);
  }
  addEventListener('pointermove',e=>{const n=performance.now();if(n-last<22)return;last=n;spawn(e.clientX,e.clientY)},{passive:true});
  addEventListener('touchmove',e=>{const n=performance.now();if(n-last<22)return;last=n;for(const t of e.touches)spawn(t.clientX,t.clientY)},{passive:true});
})();

/* ===== Sound (beeps) ===== */
let KP360_AUDIO_CTX=null;
function ensureAudio(){ if(KP360_AUDIO_CTX) return; try{ KP360_AUDIO_CTX=new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} }
function soundEnabled(){ return localStorage.getItem('kp360_sound')!=='off'; }
function setSoundEnabled(on){ localStorage.setItem('kp360_sound', on?'on':'off'); }
function beep(freq=880, dur=0.07, type='square', vol=0.06){ if(!soundEnabled() || !KP360_AUDIO_CTX) return; const o=KP360_AUDIO_CTX.createOscillator(), g=KP360_AUDIO_CTX.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(KP360_AUDIO_CTX.destination); const t=KP360_AUDIO_CTX.currentTime; o.start(t); o.stop(t+dur); g.gain.setValueAtTime(vol,t); g.gain.exponentialRampToValueAtTime(0.0001,t+dur); }
(function(){ const btn=document.getElementById('muteBtn'); if(!btn) return; const apply=()=>{btn.classList.toggle('active', !soundEnabled()); btn.textContent = soundEnabled() ? 'ğŸ”Š Sound' : 'ğŸ”‡ Muted';}; apply(); btn.addEventListener('click',()=>{ setSoundEnabled(!soundEnabled()); apply(); if(soundEnabled()){ ensureAudio(); beep(520,0.06); } });})();

/* ===== Tabs (generic) ===== */
(function(){
  const tabs=[...document.querySelectorAll('.tab')], panels=[...document.querySelectorAll('.panel')];
  const show=(id)=>{tabs.forEach(t=>t.setAttribute('aria-selected', String(t.id===`tab-${id}`))); panels.forEach(p=>p.setAttribute('aria-hidden', String(p.id!==`panel-${id}`))); if(id!=='whack' && window.KP360Whack?.end) KP360Whack.end(); if(id!=='green' && window.KP360Green?.end) KP360Green.end();};
  tabs.forEach(t=>t.addEventListener('click',()=>show(t.id.replace('tab-',''))));
})();

/* ===== Whack-a-Hub ===== */
(function(){
  const board=document.getElementById('board'),holes=[...board.querySelectorAll('.hole')],spots=holes.map(h=>h.querySelector('.spot'));
  const startBtn=document.getElementById('startBtn'),timeEl=document.getElementById('time'),scoreEl=document.getElementById('score'),bestEl=document.getElementById('best');
  const overlay=document.getElementById('overlay'),countEl=document.getElementById('count');
  let time=30,score=0,best=Number(localStorage.getItem('kp360_whack_best')||0),playing=false,counting=false,tick=null,popT=null,cdT=null,vis=-1;
  bestEl.textContent=best; const setTime=t=>{time=t;timeEl.textContent=t},setScore=s=>{score=s;scoreEl.textContent=s};
  const rand=ex=>{let i;do{i=Math.floor(Math.random()*holes.length)}while(i===ex);return i}; const hide=()=>{spots.forEach(s=>s.classList.remove('live'));vis=-1};
  function pop(){const speed=Math.max(400,900-score*20),i=rand(vis),spot=spots[i]; spot.textContent=['ğŸ‰','âœ¨','ğŸˆ','ğŸ’«','ğŸŒŸ','ğŸª„','ğŸŠ','ğŸ€','ğŸ””'][Math.floor(Math.random()*9)]; hide(); spot.classList.add('live'); vis=i; clearTimeout(popT); popT=setTimeout(pop,speed); }
  function burst(h){const c=['#6a5cff','#ff6ec7','#00c2ff','#7effb2','#ffd166']; for(let i=0;i<10;i++){const p=document.createElement('span');p.className='popper';p.style.setProperty('--tx',(Math.random()*80-40)+'px');p.style.setProperty('--ty',(Math.random()*80-40)+'px');p.style.background=c[i%c.length]; h.appendChild(p); setTimeout(()=>p.remove(),550);}}
  function hit(i){ if(!playing||i!==vis)return; const hole=holes[i],spot=spots[i]; spot.animate?.([{transform:'scale(1)'},{transform:'scale(.85)'},{transform:'scale(1)'}],{duration:120,easing:'ease-out'}); burst(hole); setScore(score+1); ensureAudio(); beep(480+Math.min(score,6)*40,0.06); pop(); }
  function begin(){ playing=true; setTime(30); setScore(0); startBtn.disabled=true; holes.forEach((h,i)=>{ h.disabled=false; h.onclick=()=>hit(i) }); pop(); clearInterval(tick); tick=setInterval(()=>{ setTime(time-1); if(time<=0) end(); },1000); }
  function show(txt){countEl.textContent=txt;countEl.classList.remove('animate');void countEl.offsetWidth;countEl.classList.add('animate');overlay.classList.add('visible')}
  function hideOv(){overlay.classList.remove('visible')}
  function arm(){ if(playing||counting) return; counting=true; setTime(30); setScore(0); startBtn.disabled=true; const seq=['3','2','1','Go!']; let k=0; show(seq[k]); ensureAudio(); beep(660,0.08);
    clearInterval(cdT); cdT=setInterval(()=>{ k++; if(k<seq.length){ show(seq[k]); ensureAudio(); beep(k<seq.length-1?660:880,0.08); } else { clearInterval(cdT); setTimeout(()=>{ hideOv(); counting=false; begin(); },400); } },1000); }
  function end(){ playing=false; clearInterval(tick); clearTimeout(popT); hide(); startBtn.disabled=false; if(score>best){best=score;localStorage.setItem('kp360_whack_best',String(best));bestEl.textContent=best;} }
  startBtn.addEventListener('click',()=>{ ensureAudio(); arm(); });
  addEventListener('keydown',e=>{ if(document.getElementById('panel-whack').getAttribute('aria-hidden')==='true') return; if(e.key>='1'&&e.key<='9'){const i=Number(e.key)-1;if(i<holes.length)hit(i)} else if(e.key===' '||e.key.toLowerCase()==='s'){e.preventDefault(); ensureAudio(); arm()} });
  window.KP360Whack={ end };
})();


/* ===== Click When Green (reaction test) ===== */
(function(){
  const panel = document.getElementById('panel-green'); if(!panel) return;
  const btnStart = document.getElementById('gStart');
  const light = document.getElementById('gLight');
  const status = document.getElementById('gStatus');
  const lastEl = document.getElementById('gLast');
  const bestEl = document.getElementById('gBest');
  const avgEl  = document.getElementById('gAvg');

  const KEY = 'kp360_green_best';
  let best = Number(localStorage.getItem(KEY)||0) || null;
  if(best && best > 0) bestEl.textContent = best;

  let running = false, armed = false, go = false, startAt = 0, timer = null, samples = [];

  function setState(s){
    light.classList.remove('state-idle','state-armed','state-wait','state-go');
    light.classList.add('state-'+s);
  }
  function reset(){
    running=false; armed=false; go=false; startAt=0;
    clearTimeout(timer); timer=null;
    btnStart.disabled=false;
    light.disabled=true; light.style.cursor='not-allowed';
    setState('idle');
  }
  function avg5(arr){
    if(!arr.length) return null;
    const a = arr.slice(-5);
    return Math.round(a.reduce((p,c)=>p+c,0)/a.length);
  }
  function scheduleGo(){
    const delay = 1000 + Math.random()*2000; // 1â€“3s
    setState('armed');
    status.textContent = 'Wait for greenâ€¦';
    armed = true;
    timer = setTimeout(()=>{
      go = true; armed = false;
      setState('go');
      light.disabled=false;
      light.style.cursor='pointer';
      startAt = performance.now();
    }, delay);
  }
  function start(){
    ensureAudio?.();
    reset();
    running = true;
    btnStart.disabled = true;
    setState('wait');
    status.textContent = 'Get readyâ€¦';
    beep?.(660,0.06);
    setTimeout(scheduleGo, 600);
  }
  function recordTooSoon(){
    status.textContent = 'Too soon! Try again.';
    ensureAudio?.(); beep?.(300,0.06);
    lastEl.textContent = 'â€“';
    setState('idle');
    btnStart.disabled=false;
  }
  function recordHit(ms){
    const t = Math.round(ms);
    samples.push(t);
    lastEl.textContent = String(t);
    const a = avg5(samples);
    avgEl.textContent = a==null ? 'â€“' : String(a);
    if(!best || t < best){
      best = t;
      bestEl.textContent = String(best);
      localStorage.setItem(KEY, String(best));
    }
    status.textContent = 'Nice! Press Start for another run.';
    ensureAudio?.(); beep?.(820,0.07);
    reset();
  }

  function onTargetClick(){
    if(!running) return;
    if(armed && !go){ recordTooSoon(); return; }
    if(go){
      const delta = performance.now() - startAt;
      recordHit(delta);
    }
  }

  btnStart.addEventListener('click', start);
  light.addEventListener('click', onTargetClick);
  // Keyboard support
  addEventListener('keydown', (e)=>{
    if(panel.getAttribute('aria-hidden')==='true') return;
    if(e.key===' '||e.key==='Enter'){
      e.preventDefault();
      if(!running) { start(); }
      else { onTargetClick(); }
    }
  });

  function end(){
    reset();
  }
  window.KP360Green = { end };
})();

/* ===== Memory Match (centered, uncut) ===== */
(function(){
  const grid=document.getElementById('mmGrid'); if(!grid) return;
  const startBtn=document.getElementById('mmStart'),againBtn=document.getElementById('mmAgain');
  const timeEl=document.getElementById('mmTime'),movesEl=document.getElementById('mmMoves'),bestEl=document.getElementById('mmBest');
  const overlay=document.getElementById('mmOverlay'),winTime=document.getElementById('mmWinTime'),winMoves=document.getElementById('mmWinMoves');
  const EMOJI=['ğŸ‰','âœ¨','ğŸˆ','ğŸ’«','ğŸŒŸ','ğŸª„']; let cards=[],first=null,lock=false,moves=0,time=0,timer=null,matched=0;
  let best=Number(localStorage.getItem('kp360_memory_best')||0)||null; if(best){bestEl.textContent=best;}
  function beepMM(f=660,d=.06,t='square',v=.05){ ensureAudio(); beep(f,d,t,v); }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a; }
  function build(){ grid.innerHTML=''; const deck=shuffle([...EMOJI,...EMOJI]); cards=deck.map((em)=>{ const btn=document.createElement('button'); btn.className='mm-card'; btn.type='button'; btn.setAttribute('aria-label','card'); btn.innerHTML=`<span class="mm-face mm-front"></span><span class="mm-face mm-back" aria-hidden="true">${em}</span>`; btn.dataset.emoji=em; btn.onclick=()=>onFlip(btn); btn.onkeydown=e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();onFlip(btn)}}; grid.appendChild(btn); return btn;}); }
  function showOverlay(on){ overlay.hidden=!on; overlay.style.display=on?'grid':'none'; }
  function reset(){ matched=0; first=null; lock=false; moves=0; time=0; clearInterval(timer); movesEl.textContent='0'; timeEl.textContent='0'; showOverlay(false); build(); }
  function start(){ ensureAudio(); reset(); cards.forEach(c=>c.classList.add('revealed')); setTimeout(()=>cards.forEach(c=>c.classList.remove('revealed')),900); clearInterval(timer); timer=setInterval(()=>{ time++; timeEl.textContent=time; },1000); }
  function onFlip(btn){ if(lock||btn.classList.contains('matched')||btn===first) return; btn.classList.add('revealed'); beepMM(520,.05); if(!first){ first=btn; return; } moves++; movesEl.textContent=moves;
    if(btn.dataset.emoji===first.dataset.emoji){ btn.classList.add('matched'); first.classList.add('matched'); matched+=2; beepMM(820,.07); first=null; if(cards.length>0 && matched===cards.length) finish(); }
    else{ lock=true; beepMM(300,.05,'square',.04); setTimeout(()=>{ btn.classList.remove('revealed'); first.classList.remove('revealed'); first=null; lock=false; },520); } }
  function finish(){ clearInterval(timer); winTime.textContent=time; winMoves.textContent=moves; showOverlay(true); if(!best || moves<best){ best=moves; localStorage.setItem('kp360_memory_best',String(best)); bestEl.textContent=best; } }
  startBtn.addEventListener('click',start); againBtn.addEventListener('click',start); reset();
})();

/* ===== Trivia Sprint (PO Hub, SOPs only) â€¢ Daily auto-modal ===== */
(function(){
  if(typeof ensureAudio!=='function'){ window.ensureAudio=function(){} }
  if(typeof beep!=='function'){ window.beep=function(){} }

  const modal   = document.getElementById('tvModal');
  const btnSkip = document.getElementById('tvSkip');
  const btnStart= document.getElementById('tvStart');
  const timeEl  = document.getElementById('tvTime');
  const scoreEl = document.getElementById('tvScore');
  const bestEl  = document.getElementById('tvBest');
  const status  = document.getElementById('tvStatus');
  const box     = document.getElementById('tvBox');
  const qText   = document.getElementById('tvQ');
  const choices = document.getElementById('tvChoices');
  if(!modal) return;

  const todayKey = (()=>{ const d=new Date(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0'); return `kp360_trivia_seen_${d.getFullYear()}-${m}-${day}` })();
  let best = Number(localStorage.getItem('kp360_trivia_best')||0) || 0; bestEl.textContent = best;

  const CANDIDATES = ['https://kp360-po.github.io/Hub/trivia.json','https://kp360-po.github.io/KB/trivia.json','https://kp360-po.github.io/KPP/trivia.json'];

  async function tryFetch(url){ const r=await fetch(url,{mode:'cors'}); if(!r.ok) throw new Error(r.status); const ct=r.headers.get('content-type')||''; return ct.includes('application/json')? r.json(): r.text(); }
  function shuffle(a){ for(let j=a.length-1;j>0;j--){const k=Math.floor(Math.random()*(j+1)); [a[j],a[k]]=[a[k],a[j]] } return a; }

  // SOP-focused HTML fallback
  function buildFromHtml(doc){
    const sopRoots=new Set();
    doc.querySelectorAll('[id*="sop"], [class*="sop"]').forEach(n=>sopRoots.add(n));
    [...doc.querySelectorAll('h1,h2,h3,h4')].forEach(h=>{
      const t=h.textContent.trim().toLowerCase();
      if(/\bsop\b|\bsops\b|standard\s*operating\s*procedure/.test(t)){
        sopRoots.add(h.closest('section,article,main,div')||h.parentElement||h);
      }
    });
    if(!sopRoots.size) return [];
    const qs=[];
    for(const root of sopRoots){
      const heads=[...root.querySelectorAll('h2,h3,h4')];
      for(const h of heads){
        const ul=(h.nextElementSibling && h.nextElementSibling.matches('ul,ol'))?h.nextElementSibling:null;
        if(!ul) continue;
        const items=[...ul.querySelectorAll(':scope>li')].map(li=>li.textContent.trim()).filter(Boolean).slice(0,4);
        if(items.length>=2){ qs.push({q:h.textContent.trim(), a:items, c:0}); }
      }
      if(qs.length<5){
        const anyList=[...root.querySelectorAll('ul,ol')];
        for(const L of anyList){
          const items=[...L.querySelectorAll(':scope>li')].map(li=>li.textContent.trim()).filter(Boolean);
          if(items.length>=3){
            const title=root.querySelector('h2,h3,h4')?.textContent?.trim()||'SOPs';
            const choices=items.slice(0,4);
            qs.push({q:`Which of the following belongs under â€œ${title}â€?`, a:choices, c:0});
            if(qs.length>=8) break;
          }
        }
      }
    }
    const seen=new Set(); return qs.filter(q=>!seen.has(q.q) && seen.add(q.q));
  }
  async function loadFromHtml(){
    const pages=[
      'https://kp360-po.github.io/Hub/sops/',
      'https://kp360-po.github.io/Hub/standard-operating-procedures/',
      'https://kp360-po.github.io/Hub/',
      'https://kp360-po.github.io/KB/',
      'https://kp360-po.github.io/KPP/'
    ];
    for(const u of pages){
      try{ const html=await (await fetch(u,{mode:'cors'})).text();
        const d=document.implementation.createHTMLDocument(''); d.documentElement.innerHTML=html;
        const qs=buildFromHtml(d); if(qs.length>=5) return qs;
      }catch(_){}
    } return null;
  }

  async function loadFromJson(){
    for(const u of CANDIDATES){
      try{ const data=await tryFetch(u); if(Array.isArray(data)&&data.length&&data[0].q&&data[0].a) return data; }catch(_){}
    } return null;
  }

  function makeDeck(pool){
    const base=shuffle(pool.slice()); const pick=base.slice(0,5);
    return pick.map(q=>{
      const arr=q.a.slice(0,4); while(arr.length<4) arr.push('None of the above');
      const ord=[0,1,2,3]; shuffle(ord); const a=ord.map(k=>arr[k]); const c=ord.indexOf(Math.min(q.c||0,arr.length-1));
      return {q:String(q.q), a, c};
    });
  }

  let deck=[], time=60, score=0, idx=0, timer=null;
  function paint(){ const cur=deck[idx]; qText.textContent=cur.q; choices.innerHTML=''; cur.a.forEach((t,i)=>{ const b=document.createElement('button'); b.className='tv-choice'; b.textContent=t; b.onclick=()=>choose(i); choices.appendChild(b); }); box.hidden=false; }
  function choose(i){ const cur=deck[idx]; const nodes=[...choices.querySelectorAll('.tv-choice')]; nodes.forEach(n=>n.disabled=true);
    if(i===cur.c){ nodes[i].classList.add('correct'); score++; scoreEl.textContent=score; ensureAudio(); beep(820,.08); }
    else{ nodes[i].classList.add('wrong'); nodes[cur.c].classList.add('correct'); ensureAudio(); beep(320,.06); }
    setTimeout(()=>{ idx++; (idx<deck.length)?paint():finish(); },600);
  }
  function tick(){ time--; timeEl.textContent=time; if(time<=0) finish(); }
  function start(){ ensureAudio(); score=0; idx=0; time=60; timeEl.textContent=time; scoreEl.textContent=score; status.textContent=''; clearInterval(timer); timer=setInterval(tick,1000); paint(); }
  function finish(){ clearInterval(timer); box.hidden=true; status.textContent=`You got ${score}/5 correct in ${60-time}s.`; if(score>(best||0)){ best=score; bestEl.textContent=best; localStorage.setItem('kp360_trivia_best', String(best)); } localStorage.setItem(todayKey,'1'); btnStart.textContent='Play Again'; }
  function closeNow(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); localStorage.setItem(todayKey,'1'); }

  btnSkip.addEventListener('click', closeNow);
  btnStart.addEventListener('click', start);
  modal.addEventListener('click', e=>{ if(e.target===modal) closeNow(); });
  addEventListener('keydown', e=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeNow(); });

  (async function initTrivia(){
    status.textContent='Loading questions from PO Hubâ€¦';
    let qs=null; const cached=sessionStorage.getItem('kp360_trivia_cache');
    if(cached){ try{ qs=JSON.parse(cached) }catch{} }
    if(!qs){ qs=await loadFromJson(); if(!qs) qs=await loadFromHtml(); if(qs) sessionStorage.setItem('kp360_trivia_cache', JSON.stringify(qs)); }
    if(!qs || !qs.length){
      status.textContent='Could not load PO Hub questions. Try again later.';
      qs=[{q:'PO stands forâ€¦',a:['Purchase Order','Product Option','Price Offer','Post Office'],c:0},
          {q:'Best place for SOPs?',a:['PO Hub','Random DM','Local PC','Whiteboard'],c:0},
          {q:'CSV stands forâ€¦',a:['Comma-Separated Values','Central Source Vault','Cost/Sales Value','Copy Saved Version'],c:0},
          {q:'WooCommerce runs onâ€¦',a:['WordPress','Drupal','Shopify','Magento'],c:0},
          {q:'404 meansâ€¦',a:['Not Found','OK','Server Error','Redirect'],c:0}];
    }
    deck=makeDeck(qs);
    status.textContent='Ready when you are.';
    if(!localStorage.getItem(todayKey)){
      modal.classList.add('show'); modal.setAttribute('aria-hidden','false');
    }
  })();
})();
</script>
</body></html>
